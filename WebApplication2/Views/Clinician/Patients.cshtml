@model WebApplication2.Models.ViewModels.ClinicianPatientsVM

@{
    ViewData["Title"] = "Patients";
}

@section Styles {
    <style>

        /* LIGHT MODE BASE */
        body {
            background: #eef2ff;
            color: #1e293b;
        }

        .refresh-btn-round {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: #d1d5db;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

            .refresh-btn-round:hover {
                background: #bfc4cc;
            }

        .kpi-card {
            border-radius: 1.3rem;
            padding: 1.4rem;
            color: white;
            height: 100%;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
        }

        .kpi-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .kpi-value {
            font-size: 2.4rem;
            font-weight: 700;
        }

        .kpi-chip {
            margin-top: 0.5rem;
            background: #f1f5f9;
            padding: 0.25rem .7rem;
            border-radius: 999px;
            font-size: .75rem;
            font-weight: 600;
            color: #1e293b;
        }

        .kpi-total {
            background: #2563eb;
        }

        .kpi-active {
            background: #16a34a;
        }

        .kpi-risk {
            background: #ef4444;
        }

        .rounded-card {
            background: white;
            border-radius: 18px;
            box-shadow: 0 4px 14px rgba(0,0,0,0.08);
        }

        /* ==========================================
                   PREMIUM BADGE STYLES (LIGHT THEME)
                   ========================================== */

        .badge {
            border-radius: 999px;
            padding: 0.2rem 0.7rem;
            font-size: 0.72rem;
            font-weight: 600;
            letter-spacing: 0.02em;
        }

        /* STATUS */
        .badge-status-stable {
            background: #dcfce7; /* soft green */
            color: #166534; /* dark green text */
            border: 1px solid #bbf7d0;
        }

        .badge-status-watch {
            background: #fef9c3; /* soft amber */
            color: #854d0e; /* dark amber text */
            border: 1px solid #fde68a;
        }

        .badge-status-critical {
            background: #fee2e2; /* soft red */
            color: #b91c1c; /* deep red text */
            border: 1px solid #fecaca;
        }

        /* RISK */
        .badge-risk-low {
            background: #e0f2fe; /* soft blue */
            color: #075985; /* dark blue text */
            border: 1px solid #bae6fd;
        }

        .badge-risk-medium {
            background: #ffedd5; /* soft orange */
            color: #9a3412;
            border: 1px solid #fed7aa;
        }

        .badge-risk-high {
            background: #fee2e2;
            color: #b91c1c;
            border: 1px solid #fecaca;
        }

        /* Smoothen hover on badges */
        .table .badge {
            transition: transform 0.12s ease, box-shadow 0.12s ease;
        }

        .table tbody tr:hover .badge {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(15, 23, 42, 0.15);
        }

        /* ==========================================
                   DARK MODE FIX
                   ========================================== */

        body.gt-theme-dark {
            background: #020617 !important;
            color: white !important;
        }

            body.gt-theme-dark * {
                color: #e5e7eb;
            }

            body.gt-theme-dark .rounded-card,
            body.gt-theme-dark .kpi-card {
                background: #020617 !important;
                border: 1px solid #1f2937 !important;
            }

            body.gt-theme-dark table,
            body.gt-theme-dark table * {
                background: #020617 !important;
                color: white !important;
            }

            /* Dark-theme badge overrides */
            body.gt-theme-dark .badge-status-stable {
                background: #15803d !important;
                color: #ecfdf3 !important;
                border-color: #16a34a !important;
            }

            body.gt-theme-dark .badge-status-watch {
                background: #a16207 !important;
                color: #fffbeb !important;
                border-color: #facc15 !important;
            }

            body.gt-theme-dark .badge-status-critical {
                background: #b91c1c !important;
                color: #fee2e2 !important;
                border-color: #ef4444 !important;
            }

            body.gt-theme-dark .badge-risk-low {
                background: #0369a1 !important;
                color: #e0f2fe !important;
                border-color: #38bdf8 !important;
            }

            body.gt-theme-dark .badge-risk-medium {
                background: #9a3412 !important;
                color: #ffedd5 !important;
                border-color: #fb923c !important;
            }

            body.gt-theme-dark .badge-risk-high {
                background: #b91c1c !important;
                color: #fee2e2 !important;
                border-color: #ef4444 !important;
            }

            /* Dark-theme KPI tweaks */
            body.gt-theme-dark .kpi-card {
                color: #e5e7eb !important; /* light grey text on dark */
            }

            body.gt-theme-dark .kpi-label {
                color: #9ca3af !important; /* softer subtitle */
            }

            body.gt-theme-dark .kpi-value {
                color: #f9fafb !important; /* bright number */
            }

            body.gt-theme-dark .kpi-chip {
                background: #111827 !important; /* dark chip background */
                color: #e5e7eb !important; /* light text */
                border: 1px solid #374151 !important; /* subtle border */
            }


    </style>
}

<div class="container mt-5 mb-5">

    <h2 class="gt-page-title mb-2">Patients</h2>

    <div class="d-flex align-items-center mb-4" style="gap:10px;">
        <span class="text-muted">Last Updated: @DateTime.Now.ToString("dd MMM yyyy HH:mm")</span>
        <button class="refresh-btn-round" onclick="location.reload();">🔄</button>
    </div>

    <!-- KPI Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-4 col-sm-6">
            <div class="kpi-card kpi-total">
                <div class="kpi-label">Total Patients</div>
                <div class="kpi-value">@Model.TotalPatients</div>
                <div class="kpi-chip">All Patients</div>
            </div>
        </div>

        <div class="col-md-4 col-sm-6">
            <div class="kpi-card kpi-active">
                <div class="kpi-label">Active Monitoring</div>
                <div class="kpi-value">@Model.UnderActiveMonitoring</div>
                <div class="kpi-chip">Recent Uploads</div>
            </div>
        </div>

        <div class="col-md-4 col-sm-6">
            <div class="kpi-card kpi-risk">
                <div class="kpi-label">High-Risk Patients</div>
                <div class="kpi-value">@Model.HighRiskCount</div>
                <div class="kpi-chip">Last 7 Days</div>
            </div>
        </div>
    </div>

    <!-- PATIENT TABLE -->
    <div class="rounded-card p-4 mb-4">

        <div class="d-flex justify-content-between mb-3">
            <h5 class="fw-bold mb-0">Patient List</h5>
            <span class="text-muted small">@Model.Patients.Count results</span>
        </div>

        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Age</th>
                        <th>Gender</th>
                        <th>Contact</th>
                        <th>Email</th>
                        <th>Ward</th>
                        <th>Last Upload</th>
                        <th>Frames</th>
                        <th>Status</th>
                        <th>Alerts</th>
                        <th>Risk</th>
                        <th>Report</th>
                    </tr>
                </thead>

                <tbody>
                    @for (int i = 0; i < Model.Patients.Count; i++)
                    {
                        var p = Model.Patients[i];

                        <tr>
                            <td>@(i + 1)</td>
                            <td>@p.PatientName</td>
                            <td>@p.Age</td>
                            <td>@p.Gender</td>
                            <td>@p.Contact</td>
                            <td>@p.Email</td>
                            <td>@p.Ward</td>
                            <td>@p.LastUploadAt.ToString("dd MMM yyyy HH:mm")</td>
                            <td>@p.LastFrames</td>

                            <td>
                                <span class="badge @p.LastStatusCss">@p.LastStatus</span>
                            </td>

                            <td>@p.AlertsLast7Days</td>

                            <td>
                                <span class="badge @p.RiskTagCss">@p.RiskTag</span>
                            </td>

                            <td>
                                <a asp-controller="Clinician"
                                   asp-action="GeneratePatientPdf"
                                   asp-route-id="@p.PatientId"
                                   class="btn btn-sm btn-outline-primary">
                                    View Report
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>

            </table>
        </div>

    </div>

</div>
